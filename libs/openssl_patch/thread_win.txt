*** openssl-1.1.1c.org/crypto/threads_win.c	2019-05-28 22:12:20.000000000 +0900
--- openssl/crypto/threads_win.c	2019-07-10 23:26:55.883810800 +0900
***************
*** 13,18 ****
--- 13,52 ----
  
  #include <openssl/crypto.h>
  
+ // Windows95で起動させるために、擬似コードで上書きする。
+ // アトミックになっていないのでアセンブラで書き直す必要あり。
+ #define InitializeCriticalSectionAndSpinCount(a, b) myInitializeCriticalSectionAndSpinCount(a)
+ int myInitializeCriticalSectionAndSpinCount(void *arg)
+ {
+ 	InitializeCriticalSection(arg);
+ 	return 1;
+ }
+ 
+ #define InterlockedCompareExchange(a, b, c) myInterlockedCompareExchange(a, b, c)
+ LONG myInterlockedCompareExchange( 
+     LPLONG volatile Destination,
+     LONG Exchange,
+     LONG Comperand
+ )
+ {
+ 	LONG ret = *Destination;
+ 	
+ 	if (*Destination == Comperand)
+ 		ret = InterlockedExchange(Destination, Exchange);
+ 	return (ret);
+ }
+ 
+ #define InterlockedExchangeAdd(a, b) myInterlockedExchangeAdd(a, b)
+ LONG myInterlockedExchangeAdd(
+   LONG volatile *Addend,
+   LONG          Value
+ )
+ {
+ 	while (Value-- > 0) 
+ 		InterlockedIncrement(Addend);
+ }
+ 
+ 
  #if defined(OPENSSL_THREADS) && !defined(CRYPTO_TDEBUG) && defined(OPENSSL_SYS_WINDOWS)
  
  CRYPTO_RWLOCK *CRYPTO_THREAD_lock_new(void)
